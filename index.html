<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TestBedz - Your Turn-Key Aerospace Testing Partner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f4f5f7; }
    .font-poppins { font-family: 'Poppins', sans-serif; }
    .btn-primary { background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: all 0.3s ease; color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4); }
    .btn-primary:disabled { background: #9ca3af; cursor: not-allowed; transform: translateY(0); box-shadow: none; }

    .form-step, .conditional-field { display: none; animation: fadeIn 0.5s ease-in-out; }
    .form-step.active, .conditional-field.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }

    .page, .view, .public-section { display: none; }
    .page.active, .view.active, .public-section.active { display: block; }

    .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
    .status-newrequest, .status-awaitingfacilityresponse { background-color: #dbeafe; color: #1e40af; }
    .status-facilitymatching, .status-contractpending { background-color: #fef3c7; color: #92400e; }
    .status-planning { background-color: #ede9fe; color: #5b21b6; }
    .status-testing { background-color: #d9f99d; color: #3f6212; }
    .status-complete { background-color: #d1fae5; color: #065f46; }

    .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; padding-left: 1.5rem; padding-right: 1.5rem; }
    .faq-answer.open { max-height: 500px; padding-top: 1rem; padding-bottom: 1.5rem; }

    .hidden { display: none !important; }

    .tooltip { position: relative; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; margin-left: 4px; color: #9ca3af; border: 1px solid #d1d5db; border-radius: 9999px; width: 16px; height: 16px; font-size: 10px; font-style: italic; }
    .tooltip .tooltiptext { visibility: hidden; width: 240px; background-color: #1f2937; color: #fff; text-align: left; border-radius: 6px; padding: 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -120px; opacity: 0; transition: opacity 0.3s; font-size: 0.75rem; font-weight: normal; font-style: normal; }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
  </style>
</head>
<body class="antialiased text-gray-800">
  <div id="app-container">

    <div id="public-page" class="page active">
      <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
          <a href="#" data-section="home-content" class="public-nav-item flex items-center space-x-2">
            <svg class="h-8 w-8 text-blue-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span class="text-xl font-bold text-gray-800">TestBedz</span>
          </a>
          <div class="flex items-center space-x-6">
            <a href="#" data-section="home-content" class="public-nav-item font-semibold text-blue-600 hover:text-blue-600">Home</a>
            <a href="#" data-section="facilities-content" class="public-nav-item font-semibold text-gray-600 hover:text-blue-600">Facilities</a>
            <a href="#" data-section="faq-content" class="public-nav-item font-semibold text-gray-600 hover:text-blue-600">FAQ</a>
            <a href="#" data-section="resources-content" class="public-nav-item font-semibold text-gray-600 hover:text-blue-600">Resources</a>
            <button id="show-login-btn" class="font-semibold text-gray-600 hover:text-blue-600">Log In</button>
            <a href="#rfq-form" class="btn-primary font-semibold px-5 py-2 rounded-lg">Get Started</a>
          </div>
        </nav>
      </header>
      <main>
        <div id="home-content" class="public-section active">
          <section class="container mx-auto px-6 pt-24 pb-16 text-center"><h1 class="font-poppins text-4xl md:text-6xl font-bold text-gray-900 leading-tight">Your End-to-End Testing Partner.</h1><p class="text-xl md:text-2xl mt-4 text-gray-600 max-w-3xl mx-auto">From initial planning to final report, TestBedz is your dedicated concierge for aerospace testing. Submit a request and get a dedicated dashboard to manage your entire test campaign.</p><div class="mt-8"><a href="#rfq-form" class="btn-primary text-white font-bold px-8 py-4 rounded-lg text-lg">Create Your Test Campaign</a></div></section>
          <section id="rfq-form" class="py-20"><div class="container mx-auto px-6"><div class="bg-white max-w-4xl mx-auto p-8 md:p-12 rounded-xl shadow-2xl border border-gray-200"><h2 class="font-poppins text-3xl font-bold text-center text-gray-900 mb-4">Create Your Test Campaign Now!</h2><p class="text-lg text-center text-gray-600 mb-8">Create your Project Ticket!</p><form id="signup-form"><div class="form-step active"><h3 class="font-semibold text-xl mb-6 text-center">Step 1: Company & Contact</h3><div class="space-y-6"><div><label class="block text-sm font-medium text-gray-700">Company Name</label><input type="text" name="CompanyName" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium text-gray-700">Your Full Name</label><input type="text" name="ContactName" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium text-gray-700">Contact Email</label><input type="email" name="ContactEmail" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium text-gray-700">Preferred Testing Area (Zip Code)</label><input type="text" name="ZipCode" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div></div><div class="form-step"><h3 class="font-semibold text-xl mb-6 text-center">Step 2: Primary Test Needs</h3><div class="space-y-6"><div><label class="block text-sm font-medium text-gray-700">Campaign Purpose</label><textarea name="TestPurpose" rows="2" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="e.g., Qualification for launch, developmental testing..."></textarea></div><div><label class="block text-sm font-medium text-gray-700">Primary Test Type</label><select id="initial-test-type" name="PrimaryTestType" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"><option value="">Select a test...</option><option value="Vibration">Vibration</option><option value="Thermal">Thermal</option><option value="Shock">Shock</option></select></div><div id="Vibration-params" class="conditional-field space-y-2"><label class="block text-sm font-medium text-gray-700">Vibration Parameters</label><input type="text" name="FreqRange" placeholder="Approx. Frequency Range (e.g., 5-2000 Hz)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div id="Thermal-params" class="conditional-field space-y-2"><label class="block text-sm font-medium text-gray-700">Thermal Parameters</label><input type="text" name="TempRange" placeholder="Approx. Temperature Range (e.g., -70 to 120 C)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div id="Shock-params" class="conditional-field space-y-2"><label class="block text-sm font-medium text-gray-700">Shock Parameters</label><input type="text" name="ShockRange" placeholder="Approx. Peak Acceleration (e.g., 1500 G)" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div></div><div class="form-step"><h3 class="font-semibold text-xl mb-6 text-center">Step 3: Asset & Schedule</h3><div class="space-y-6"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700">Asset Dimensions (cm)</label><input type="text" name="ArticleDimensions" placeholder="e.g., 30x20x10" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium text-gray-700">Asset Mass (kg)</label><input type="number" name="ArticleWeight" placeholder="e.g., 5" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div><div><label class="block text-sm font-medium text-gray-700">Estimated Start Date</label><input type="date" name="DesiredStartDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium text-gray-700">Estimated Duration (days)</label><input type="number" name="EstDuration" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="e.g., 3"></div><div class="flex items-center"><input type="checkbox" id="duration-na" name="duration-na" class="h-4 w-4 text-blue-600 border-gray-300 rounded"><label for="duration-na" class="ml-2 block text-sm text-gray-900">I'm not sure / N/A</label></div></div></div><div class="form-step"><h3 class="font-semibold text-xl mb-6 text-center">Step 4: Create Your Secure Account</h3><div class="space-y-6"><div><label class="block text-sm font-medium text-gray-700">Email (for login)</label><input type="email" name="email" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium text-gray-700">Password</label><input type="password" name="password" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div></div><div class="mt-10 flex justify-between"><button type="button" id="prev-btn" class="bg-gray-200 text-gray-700 font-semibold px-6 py-2 rounded-lg" style="display: none;">Back</button><button type="button" id="next-btn" class="btn-primary font-semibold px-6 py-2 rounded-lg ml-auto">Next</button><button type="submit" id="submit-btn" class="btn-primary font-semibold px-6 py-2 rounded-lg ml-auto" style="display: none;">Submit & Create Account</button></div></form></div></div></section>
        </div>
        <div id="facilities-content" class="public-section">
          <section class="py-20">
            <div class="container mx-auto px-6">
              <h1 class="font-poppins text-4xl font-bold text-center text-gray-900 mb-4">Our Testing Facilities</h1>
              <p class="text-lg text-center text-gray-600 mb-12 max-w-2xl mx-auto">Explore our world-class aerospace testing facilities, each equipped with state-of-the-art technology and expert staff to ensure your project's success.</p>
              <div id="facilities-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>
          </section>
        </div>
        <div id="faq-content" class="public-section">
          <section class="py-20"><div class="container mx-auto px-6"><h1 class="font-poppins text-4xl font-bold text-center text-gray-900 mb-4">Frequently Asked Questions</h1><p class="text-lg text-center text-gray-600 mb-12 max-w-2xl mx-auto">Find answers to common questions about our services, processes, and how we can help your project succeed.</p><div class="max-w-3xl mx-auto space-y-4"><div class="bg-white rounded-lg shadow-md"><div class="faq-question cursor-pointer p-6 flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800">What kind of testing services do you offer?</h3><svg class="faq-icon w-6 h-6 text-gray-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></div><div class="faq-answer text-gray-600"><p>TestBedz provides a comprehensive suite of aerospace testing services, including but not limited to: Vibration, Thermal, Vacuum (TVAC), EMI/EMC, Non-Destructive Testing (NDT), and Wind Tunnel testing. We act as your single point of contact to manage the entire process with our network of certified lab partners.</p></div></div><div class="bg-white rounded-lg shadow-md"><div class="faq-question cursor-pointer p-6 flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800">How does the process work?</h3><svg class="faq-icon w-6 h-6 text-gray-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></div><div class="faq-answer text-gray-600"><p>It's simple! 1) You submit a test campaign request through our platform. 2) We match your requirements with the best-suited facilities in our network. 3) We handle all the planning, logistics, and communication. 4) You monitor progress and access results through your secure client dashboard. 5) We deliver a final, comprehensive test report.</p></div></div><div class="bg-white rounded-lg shadow-md"><div class="faq-question cursor-pointer p-6 flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800">Who are your testing partners?</h3><svg class="faq-icon w-6 h-6 text-gray-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></div><div class="faq-answer text-gray-600"><p>We partner with a wide range of accredited and certified testing laboratories across the country. Our partners are rigorously vetted to ensure they meet the highest industry standards, including ISO, NADCAP, and specific OEM certifications. Confidentiality agreements prevent us from listing them publicly, but we match your project's specific needs (e.g., ITAR compliance) to the right facility.</p></div></div></div></div></section>
        </div>
        <div id="resources-content" class="public-section">
          <section class="py-20">
            <div class="container mx-auto px-6">
              <h1 class="font-poppins text-4xl font-bold text-center text-gray-900 mb-4">Educational Resources</h1>
              <p class="text-lg text-center text-gray-600 mb-12 max-w-2xl mx-auto">Explore our articles and guides on aerospace testing to stay informed and prepare for your next project.</p>
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col"><img src="https://placehold.co/600x400/3b82f6/ffffff?text=Vibration+Testing" alt="Vibration testing illustration" class="w-full h-48 object-cover"><div class="p-6 flex-grow"><h3 class="font-poppins font-bold text-xl mb-2">An Introduction to Sine and Random Vibration Testing</h3><p class="text-gray-600 mb-4">Understand the key differences between sine and random vibration profiles and when to apply each for your hardware qualification.</p></div><div class="p-6 pt-0"><a href="#" class="font-semibold text-blue-600 hover:text-blue-700">Read More →</a></div></div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col"><img src="https://placehold.co/600x400/8b5cf6/ffffff?text=TVAC+Testing" alt="Thermal vacuum chamber illustration" class="w-full h-48 object-cover"><div class="p-6 flex-grow"><h3 class="font-poppins font-bold text-xl mb-2">Demystifying TVAC: What to Expect in a Thermal Vacuum Test</h3><p class="text-gray-600 mb-4">From outgassing to temperature cycling, we break down the critical phases of a TVAC test and how to prepare your test article.</p></div><div class="p-6 pt-0"><a href="#" class="font-semibold text-blue-600 hover:text-blue-700">Read More →</a></div></div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col"><img src="https://placehold.co/600x400/10b981/ffffff?text=Test+Fixtures" alt="Test fixture illustration" class="w-full h-48 object-cover"><div class="p-6 flex-grow"><h3 class="font-poppins font-bold text-xl mb-2">The Unsung Hero: Why Good Test Fixture Design is Crucial</h3><p class="text-gray-600 mb-4">A great test can be ruined by a poor fixture. Learn the design principles for creating a fixture that won't compromise your results.</p></div><div class="p-6 pt-0"><a href="#" class="font-semibold text-blue-600 hover:text-blue-700">Read More →</a></div></div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col"><img src="https://placehold.co/600x400/f59e0b/ffffff?text=SPRL+Plates" alt="SPRL Plate illustration" class="w-full h-48 object-cover"><div class="p-6 flex-grow"><h3 class="font-poppins font-bold text-xl mb-2">Understanding SPRL Plate Interfacing</h3><p class="text-gray-600 mb-4">Learn about Shaker-Plate-Resonance-Limiting (SPRL) plates, their importance in vibration testing, and how to properly document your interface requirements.</p></div><div class="p-6 pt-0"><a href="#" class="font-semibold text-blue-600 hover:text-blue-700">Read More →</a></div></div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div id="dashboard-page" class="page">
        <div class="relative min-h-screen md:flex">
            <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>
            <div id="sidebar" class="bg-white text-gray-800 w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out z-30 shadow-lg flex flex-col">
              <div>
                <div class="flex items-center justify-between px-4">
                  <a href="#" class="flex items-center space-x-2">
                    <svg class="h-8 w-8 text-blue-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span class="text-xl font-bold">TestBedz</span>
                  </a>
                  <button id="sidebar-close-btn" class="text-2xl md:hidden text-gray-600">&times;</button>
                </div>
                <nav class="mt-10 px-4">
                  <a href="#" data-view="dashboard" class="nav-item active flex items-center p-3 my-1 rounded-lg bg-gray-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>Campaigns</a>
                  <a href="#" data-view="calendar" class="nav-item flex items-center p-3 my-1 rounded-lg hover:bg-gray-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>Facility Calendar</a>
                </nav>
              </div>
              <div class="mt-auto p-4 border-t">
                <button id="logout-btn" class="w-full text-left flex items-center p-3 my-1 text-gray-700 rounded-lg hover:bg-gray-200">
                  <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                  Log Out
                </button>
              </div>
            </div>
    
            <div class="flex-1 flex flex-col overflow-hidden">
              <header class="bg-white shadow-sm">
                <div class="px-6 py-4 flex items-center justify-between">
                    <h1 id="view-title" class="text-xl font-semibold text-gray-700">Your Test Campaigns</h1>
                    <button id="hamburger-btn" class="text-gray-500 focus:outline-none md:hidden">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg>
                    </button>
                </div>
              </header>
    
              <main class="flex-1 p-6 bg-gray-100 overflow-y-auto">
                <div id="dashboard-view" class="view active"><div class="flex justify-between items-center mb-6"><h1 class="font-poppins text-3xl font-bold text-gray-900">Your Test Campaigns</h1><button id="show-new-campaign-modal-btn" class="btn-primary font-semibold px-4 py-2 rounded-lg">+ New Campaign</button></div><div class="bg-white p-6 rounded-xl shadow-md"><div id="campaign-tickets-container" class="w-full text-left"></div></div></div>
                <div id="campaign-detail-view" class="view"><button id="back-to-dashboard-btn" class="font-semibold text-blue-600 mb-6">← Back to All Campaigns</button><div class="flex justify-between items-start"><h2 class="font-poppins text-2xl font-bold" id="detail-campaign-purpose"></h2><span id="detail-campaign-status" class="status-badge"></span></div><p class="text-gray-600 mt-2" id="detail-campaign-background"></p><hr class="my-6"><h3 class="font-poppins text-xl font-bold mb-4">Individual Tests in this Campaign</h3><div id="tests-container" class="space-y-4"></div><div class="mt-6"><button id="show-add-test-modal-btn" class="w-full text-center py-3 bg-blue-50 hover:bg-blue-100 text-blue-600 font-semibold rounded-lg border-2 border-dashed border-blue-200 transition-colors">+ Add a New Test</button></div></div>
                <div id="calendar-view" class="view"><h1 class="font-poppins text-3xl font-bold text-gray-900">Facility Calendar</h1><p class="text-lg text-gray-600 mt-2">View high-level availability for your matched testing facilities.</p><div class="mt-8 bg-white p-6 rounded-xl shadow-md"><p class="text-center text-gray-500">Calendar functionality coming soon.</p></div></div>
              </main>
            </div>
          </div>
    </div>
    
    <div id="admin-page" class="page">
      <div class="relative min-h-screen md:flex">
        <div id="admin-sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>
        <div id="admin-sidebar" class="bg-white text-gray-800 w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out z-30 shadow-lg flex flex-col">
          <div>
            <div class="flex items-center justify-between px-4">
              <a href="#" class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-purple-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span class="text-xl font-bold">TestBedz Admin</span>
              </a>
              <button id="admin-sidebar-close-btn" class="text-2xl md:hidden text-gray-600">&times;</button>
            </div>
            <nav class="mt-10 px-4">
              <a href="#" data-view="admin-dashboard" class="nav-item active flex items-center p-3 my-1 rounded-lg bg-gray-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>All Campaigns</a>
            </nav>
          </div>
          <div class="mt-auto p-4 border-t">
            <button id="admin-logout-btn" class="w-full text-left flex items-center p-3 my-1 text-gray-700 rounded-lg hover:bg-gray-200">
              <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
              Log Out
            </button>
          </div>
        </div>
        <div class="flex-1 flex flex-col overflow-hidden">
          <header class="bg-white shadow-sm">
            <div class="px-6 py-4 flex items-center justify-between">
                <h1 id="admin-view-title" class="text-xl font-semibold text-gray-700">All Campaigns</h1>
                <button id="admin-hamburger-btn" class="text-gray-500 focus:outline-none md:hidden">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg>
                </button>
            </div>
          </header>
          <main class="flex-1 p-6 bg-gray-100 overflow-y-auto">
            <div id="admin-dashboard-view" class="view active">
              <div class="bg-white p-6 rounded-xl shadow-md">
                <div id="admin-campaigns-container" class="w-full text-left"></div>
              </div>
            </div>
            <div id="admin-campaign-detail-view" class="view">
              <button id="admin-back-to-dashboard-btn" class="font-semibold text-blue-600 mb-6">← Back to All Campaigns</button>
              <div class="bg-white p-6 rounded-xl shadow-md">
                <div class="flex justify-between items-start"><h2 class="font-poppins text-2xl font-bold" id="admin-detail-campaign-purpose"></h2><span id="admin-detail-campaign-status" class="status-badge"></span></div>
                <p class="text-gray-600 mt-2" id="admin-detail-campaign-background"></p>
                <p class="text-gray-500 text-sm mt-2">Submitted by: <strong id="admin-detail-user-email"></strong></p>
                <hr class="my-6">
                <h3 class="font-poppins text-xl font-bold mb-4">Individual Tests in this Campaign</h3>
                <div id="admin-tests-container" class="space-y-4"></div>
                <hr class="my-6">
                <h3 class="font-poppins text-xl font-bold mb-4">Update Status</h3>
                <div id="admin-status-controls" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>

    <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full relative">
            <button id="close-login-modal-btn" class="absolute top-2 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
            <h2 class="font-poppins text-2xl font-bold text-gray-900 mb-4">Client Log In</h2>
            <form id="login-form" class="space-y-4">
                <input type="email" id="login-email" placeholder="Enter your email" required class="w-full border-gray-300 rounded-md shadow-sm">
                <input type="password" id="login-password" placeholder="Enter your password" required class="w-full border-gray-300 rounded-md shadow-sm">
                <div class="flex items-center justify-center">
                    <input type="checkbox" id="admin-login-checkbox" class="h-4 w-4 rounded">
                    <label for="admin-login-checkbox" class="ml-2 block text-sm text-gray-900">Log in as Admin</label>
                </div>
                <button type="submit" class="w-full btn-primary font-semibold py-3 rounded-lg">Log In</button>
            </form>
        </div>
    </div>
    <div id="message-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center hidden z-50 p-4"><div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full"><h3 id="message-title" class="font-poppins text-xl font-bold text-gray-900 mb-4"></h3><p id="message-text" class="text-gray-600 mb-6"></p><button id="close-message-btn" class="w-full btn-primary font-semibold py-2 rounded-lg">Close</button></div></div>
    <div id="add-test-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center hidden z-50 p-4"><div class="bg-white p-8 rounded-xl shadow-2xl max-w-3xl w-full relative max-h-[90vh] overflow-y-auto"><button id="close-add-test-modal-btn" class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button><h2 class="font-poppins text-2xl font-bold text-gray-900 mb-6">Add Specific Test Details</h2><form id="add-test-form" class="space-y-6"><div id="add-test-form-steps"></div><div class="pt-6 border-t flex justify-end"><button type="submit" class="btn-primary font-semibold py-3 px-6 rounded-lg">Add Test to Campaign</button></div></form></div></div>
    <div id="new-campaign-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center hidden z-50 p-4"><div class="bg-white p-8 rounded-xl shadow-2xl max-w-lg w-full relative"><button id="close-new-campaign-modal-btn" class="absolute top-2 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button><h2 class="font-poppins text-2xl font-bold mb-4">Create New Test Campaign</h2><form id="new-campaign-form" class="space-y-4"><div><label class="block text-sm font-medium text-gray-700">Campaign Purpose</label><input name="TestPurpose" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" /></div><div><label class="block text-sm font-medium text-gray-700">Campaign Background</label><textarea name="TestBackground" rows="3" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea></div><div class="flex justify-end"><button type="submit" class="btn-primary font-semibold px-4 py-2 rounded-lg">Create</button></div></form></div></div>
    <div id="facility-intro-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center hidden z-50 p-4"><div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md w-full"><h2 class="font-poppins text-2xl font-bold text-gray-900 mb-2">You've Been Matched!</h2><p class="text-gray-600 mb-4">Based on your request, we've matched you with:</p><h3 id="facility-name" class="font-poppins text-xl font-bold text-blue-600 mb-4"></h3><p id="facility-blurb" class="text-gray-600 mb-6 text-left"></p><button id="proceed-to-dashboard-btn" class="w-full btn-primary font-semibold py-2 rounded-lg">Proceed to Your Dashboard</button></div></div>
    <div id="facility-info-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center hidden z-50 p-4"><div class="bg-white p-4 sm:p-8 rounded-xl shadow-2xl max-w-4xl w-full relative max-h-[90vh] overflow-y-auto"><button id="close-facility-info-modal-btn" class="absolute top-4 right-4 text-3xl text-gray-500 hover:text-gray-800">&times;</button><div class="grid md:grid-cols-2 gap-8 items-start"><div><img id="modal-facility-img" src="" alt="Facility Image" class="w-full h-auto rounded-lg shadow-lg"></div><div><h2 id="modal-facility-name" class="font-poppins text-3xl font-bold text-gray-900 mb-4"></h2><p id="modal-facility-desc" class="text-gray-600 mb-6"></p><h3 class="font-poppins text-xl font-bold text-gray-800 mb-2">Key Specifications</h3><ul id="modal-facility-specs" class="list-disc list-inside text-gray-700 space-y-1"></ul></div></div></div></div>

    <div id="field-templates" class="hidden">
        <div id="standards-step" class="space-y-4"><div><label class="block text-sm font-medium text-gray-700">Relevant Standard</label><p class="text-xs text-gray-500">Selecting a standard helps us auto-populate test parameters later.</p><select id="test-standard-select" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"><option value="Other">Other / N/A / I'm not sure</option><option value="GEVS">GEVS (NASA Standard)</option><option value="MIL-STD">MIL-STD (Military Standard)</option></select></div><div><label class="block text-sm font-medium text-gray-700">Test Type</label><select id="new-test-type-select" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required><option value="">Select a test...</option><option value="Vibration">Vibration</option><option value="Thermal">Thermal</option><option value="Vacuum">Vacuum</option><option value="EMI/EMC">EMI/EMC</option><option value="NDT">NDT</option><option value="Wind Tunnel">Wind Tunnel</option></select></div></div>
        <div id="Vibration-fields" class="space-y-4"><div><label class="block text-sm font-medium">External Accelerometers</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="How many are needed and what are their precise locations?"></div><div><label class="block text-sm font-medium">Test Axes</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., X, Y, and Z"></div><div class="pt-4 border-t"><label class="flex items-center text-sm font-medium">Mounting Plan<span class="tooltip">i<span class="tooltiptext">Describe how the device will be mounted. Do you have a custom fixture? If providing a plate, do you have any natural frequencies? See Resources tab for SPRL Plate info.</span></span></label><textarea class="mt-1 w-full border-gray-300 rounded-md" rows="2" placeholder="e.g., Bolted to shaker head via custom adapter plate..."></textarea><input type="file" class="mt-2 text-sm"></div><div><label class="block text-sm font-medium">Test Profiles & Freq. Range</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., GEVS proto-flight, 20-2000 Hz"></div><div><label class="block text-sm font-medium">Cycles</label><input type="number" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 3 per axis"></div><div><label class="block text-sm font-medium">Test Types</label><div class="mt-2 grid grid-cols-3 gap-2"><label class="inline-flex items-center"><input type="checkbox" class="rounded"> <span class="ml-2">Random</span></label><label class="inline-flex items-center"><input type="checkbox" class="rounded"> <span class="ml-2">Sine-Burst</span></label><label class="inline-flex items-center"><input type="checkbox" class="rounded"> <span class="ml-2">Sine-Sweep</span></label></div></div></div>
        <div id="Thermal-fields" class="space-y-4"><div><label class="block text-sm font-medium">Test Type</label><select class="mt-1 w-full border-gray-300 rounded-md"><option>Operational</option><option>Survival</option></select></div><div><label class="block text-sm font-medium">Number of Cycles</label><input type="number" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 1 for survival, 8 for operational"></div><div><label class="block text-sm font-medium">Temperature Range (°C)</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., -80 to +120"></div><div><label class="block text-sm font-medium">Dwell Time (hours)</label><input type="number" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 2"></div><div><label class="block text-sm font-medium">Thermocouples (Original)</label><div class="grid grid-cols-2 gap-4"><input type="number" class="mt-1 w-full border-gray-300 rounded-md" placeholder="# of spots"><select class="mt-1 w-full border-gray-300 rounded-md"><option>Attached</option><option>Free</option></select></div></div><div><label class="block text-sm font-medium">Interface (Power Wires & Data Signals)</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 28V DC @ 2A, RS-422 for telemetry, # of wire signals"></div><div><label class="block text-sm font-medium">Temperature Tracking</label><select class="mt-1 w-full border-gray-300 rounded-md"><option>Automated by facility</option><option>Requires TestBedz observation</option></select></div><div class="pt-4 border-t"><label class="block text-sm font-medium">Required Test Points</label><div class="mt-2 grid grid-cols-3 gap-2"><label class="inline-flex items-center"><input type="checkbox" class="rounded"> <span class="ml-2">Cold Survival</span></label><label class="inline-flex items-center"><input type="checkbox" class="rounded"> <span class="ml-2">Hot Operational</span></label><label class="inline-flex items-center"><input type="checkbox" class="rounded"> <span class="ml-2">Cold Operational</span></label></div></div><div><label class="block text-sm font-medium">Number of Test Points to reach steady state</label><input type="number" class="mt-1 w-full border-gray-300 rounded-md" placeholder="Typically 3"></div><div><label class="block text-sm font-medium">Thermocouples (New)</label><select class="mt-1 w-full border-gray-300 rounded-md" id="thermocouple-select"><option value="1-9">1-9</option><option value="10+">10+</option></select></div><div id="thermocouple-reason-box" class="hidden"><label class="block text-sm font-medium">Reason for 10+ thermocouples</label><textarea class="mt-1 w-full border-gray-300 rounded-md" rows="2"></textarea></div></div>
        <div id="Vacuum-fields" class="space-y-4"><div><label class="block text-sm font-medium">Pump-down Time Requirement (hours)</label><input type="number" class="mt-1 w-full border-gray-300 rounded-md"></div><div class="pt-4 border-t"><label class="flex items-center text-sm font-medium">Target Pressure (Torr)<span class="tooltip">i<span class="tooltiptext">Note any material restrictions (e.g., no Cadmium/Zinc). Common pressure levels:<br>Upper Atmosphere: 1x10⁻⁴<br>Low Earth Orbit: 1x10⁻⁶<br>Moon/Mars Surface: 1x10⁻⁸</span></span></label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 1x10^-6 Torr"></div><div><label class="block text-sm font-medium">Enclosed Volumes?</label><div class="mt-2 flex space-x-4"><label class="inline-flex items-center"><input type="radio" name="enclosed-vol" class="rounded"> <span class="ml-2">Yes</span></label><label class="inline-flex items-center"><input type="radio" name="enclosed-vol" class="rounded" checked> <span class="ml-2">No</span></label></div></div><div><label class="block text-sm font-medium">Is Venting Required?</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="If yes, describe venting provisions"></div></div>
        <div id="EMIEMC-fields" class="space-y-4"><div><label class="block text-sm font-medium">Modes of Operation During Test</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., Standby, Full Power Transmit"></div><div><label class="block text-sm font-medium">Power Requirements</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 28V DC, 5A peak"></div><div><label class="block text-sm font-medium">Testing Objective</label><select class="mt-1 w-full border-gray-300 rounded-md"><option>Radiated Emissions</option><option>Conducted Emissions</option><option>Radiated Immunity</option><option>Conducted Immunity</option><option>ESD Immunity</option></select></div></div>
        <div id="NDT-fields" class="space-y-4"><div><label class="block text-sm font-medium">Primary Objective</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., Detect internal voids, check weld integrity"></div><div><label class="block text-sm font-medium">Material(s)</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., Carbon Fiber Composite, Aluminum 6061"></div></div>
        <div id="WindTunnel-fields" class="space-y-4"><div><label class="block text-sm font-medium">Desired Wind Speed Sweep (mph)</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., 0 to 150"></div><div><label class="block text-sm font-medium">Desired Angle of Attack Sweep (°)</label><input type="text" class="mt-1 w-full border-gray-300 rounded-md" placeholder="e.g., -5 to 20"></div></div>
    </div>
  </div>

  <script type="module">
    // Firebase Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, onSnapshot, doc, updateDoc, serverTimestamp, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    document.addEventListener('DOMContentLoaded', function () {
      const firebaseConfig = {
        apiKey: "AIzaSyDHnIenNERDSwZ0ZAHnBxUGfpxxICrtyeM",
        authDomain: "testbedz.firebaseapp.com",
        projectId: "testbedz",
        storageBucket: "testbedz.appspot.com",
        messagingSenderId: "366264209336",
        appId: "1:366264209336:web:f4e5b6f3378d9f6c10c94d",
        measurementId: "G-ELJ40Q915B"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const sprFacilities = [ { id: 'vibe-t2k-289', name: 'Vibration Table (Unholtz Dickie T2K)', shortDesc: '18"x18" slip plate shaker for vibration and shock testing up to 2000 Hz.', image: 'images/Unholtz Dickie T2K SN 289.jpg', longDesc: 'The Unholtz Dickie T2K is a versatile electrodynamic shaker located in SPRL room 1007, designed for a wide range of vibration testing applications.', specs: { 'Model': 'T2K', 'Serial Number': '289', 'Property Number': 'UN282030', 'Plate Size': '18" x 18" slip plate', 'Stinger Diameter': '13.5 inches', 'Frequency Range': '5 - 2000 Hz', 'Max Acceleration': '61 G', 'Sine Force': '1,700 lbf peak', 'Random Force': '1,330 lbf RMS', 'Documentation': 'Detailed hole pattern and specs available upon request.' } }, { id: 'vibe-s600', name: 'Vibration Table (Unholtz Dickie S600)', shortDesc: '25"x25" slip plate shaker for larger articles and higher force requirements.', image: 'images/Unholtz Dickie S600.jpg', longDesc: 'Located in SPRL room 1007, the Unholtz Dickie S600 provides increased capacity for larger test articles, delivering up to 7,000 lbs of force.', specs: { 'Model': 'S600', 'Plate Size': '25" x 25" slip plate', 'Stinger Diameter': '13.5 inches', 'Frequency Range': '2.5 - 2000 Hz', 'Force Rating': '7,000 lbs', 'Sine Force': '6,500 lbf peak', 'Random Force': '5,700 lbf RMS', 'Documentation': 'Detailed hole pattern and specs available upon request.' } }, { id: 'tvac-bemco', name: 'Thermal Vacuum Chamber (BEMCO)', shortDesc: '27.3 cubic feet TVAC chamber for simulating the vacuum and thermal conditions of space.', image: 'images/BEMCO Aein SCUSSC 28.jpg', longDesc: 'Our BEMCO TVAC chamber in SPRL room 1065 is ideal for component and subsystem level testing, allowing for precise control of temperature and pressure to mimic various orbital environments.', specs: { 'Model': 'Aein SC/USSC 28', 'Property Number': 'UN237936', 'Volume': '27.3 cubic feet', 'Temperature Range': '-55°C to +150°C', 'Max Ramp Rate': '3.5°C per minute', 'Vacuum Level': '5 x 10⁻⁶ Torr' } }, { id: 'thermal-csz', name: 'Thermal Chamber (Cincinnati Sub-Zero)', shortDesc: '32 cubic feet chamber for temperature and humidity cycling at ambient pressure.', image: 'images/Q-32-11-SCAC Cincinnati Sub-Zero, Tenney.jpg', longDesc: 'This Tenney-made chamber from Cincinnati Sub-Zero (room 1065) provides a large volume for thermal and humidity testing of articles that do not require vacuum.', specs: { 'Model': 'Q-32-11-SC/AC', 'Volume': '32 cubic feet', 'Internal Dimensions': '38"W x 38"D x 38"H', 'Temperature Range': '-65°C to +190°C', 'Humidity Range': '10% to 98% RH' } }, { id: 'vacuum-tsc', name: 'Vacuum Chamber (TSC-150)', shortDesc: 'High-performance vacuum chamber equipped with a turbomolecular pump.', image: 'images/TSC-150 Turbomolecular Pump Frequency Converter.jpg', longDesc: 'The TSC-150 in room 1065 is designed for bakeouts and vacuum exposure testing where precise thermal control is not required. Its turbomolecular pump ensures rapid pump-down and a clean, high-vacuum environment.', specs: { 'Model': 'TSC-150', 'Pump Type': 'Turbomolecular Pump', 'Primary Use': 'Vacuum Bakeout, Material Outgassing', 'Controller': 'Frequency Converter for precision pump control' } } ];
      const mockFacilities = [ { id: 'fac_1', name: 'Aero-Enviro Labs' }, { id: 'fac_2', name: 'Dynamic Test Solutions' }, { id: 'fac_3', name: 'Cryo-Vac Specialists' } ];
      
      const publicPage = document.getElementById('public-page');
      const dashboardPage = document.getElementById('dashboard-page');
      const adminPage = document.getElementById('admin-page');
      const views = document.querySelectorAll('.view');
      const publicNavItems = document.querySelectorAll('.public-nav-item');
      const publicSections = document.querySelectorAll('.public-section');
      const getStartedLinks = document.querySelectorAll('a[href="#rfq-form"]');
      const signupForm = document.getElementById('signup-form');
      const loginForm = document.getElementById('login-form');
      const newCampaignForm = document.getElementById('new-campaign-form');
      const addTestForm = document.getElementById('add-test-form');
      const loginModal = document.getElementById('login-modal');
      const newCampaignModal = document.getElementById('new-campaign-modal');
      const addTestModal = document.getElementById('add-test-modal');
      const messageModal = document.getElementById('message-modal');
      const facilityIntroModal = document.getElementById('facility-intro-modal');
      const showLoginBtn = document.getElementById('show-login-btn');
      const dashboardNavItems = document.querySelectorAll('#dashboard-page .nav-item');
      const faqContainer = document.getElementById('faq-content');
      const showNewCampaignModalBtn = document.getElementById('show-new-campaign-modal-btn');
      const showAddTestModalBtn = document.getElementById('show-add-test-modal-btn');
      const backToDashboardBtn = document.getElementById('back-to-dashboard-btn');
      const closeMessageBtn = document.getElementById('close-message-btn');
      const closeLoginModalBtn = document.getElementById('close-login-modal-btn');
      const closeNewCampaignModalBtn = document.getElementById('close-new-campaign-modal-btn');
      const closeAddTestModalBtn = document.getElementById('close-add-test-modal-btn');
      const proceedToDashboardBtn = document.getElementById('proceed-to-dashboard-btn');
      const signupFormSteps = document.querySelectorAll('#signup-form .form-step');
      const sidebar = document.getElementById('sidebar');
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const sidebarOverlay = document.getElementById('sidebar-overlay');
      const sidebarCloseBtn = document.getElementById('sidebar-close-btn');
      const viewTitle = document.getElementById('view-title');
      const logoutBtn = document.getElementById('logout-btn');
      const facilitiesGrid = document.getElementById('facilities-grid');
      const facilityInfoModal = document.getElementById('facility-info-modal');
      const closeFacilityInfoModalBtn = document.getElementById('close-facility-info-modal-btn');
      const adminLogoutBtn = document.getElementById('admin-logout-btn');
      const adminCampaignsContainer = document.getElementById('admin-campaigns-container');
      const adminCampaignDetailView = document.getElementById('admin-campaign-detail-view');
      const adminDashboardView = document.getElementById('admin-dashboard-view');
      const adminBackToDashboardBtn = document.getElementById('admin-back-to-dashboard-btn');
      const adminSidebar = document.getElementById('admin-sidebar');
      const adminHamburgerBtn = document.getElementById('admin-hamburger-btn');
      const adminSidebarOverlay = document.getElementById('admin-sidebar-overlay');
      const adminSidebarCloseBtn = document.getElementById('admin-sidebar-close-btn');
      const adminViewTitle = document.getElementById('admin-view-title');

      let currentSignupStep = 1;
      let currentCampaignId = null;
      let unsubscribeCampaigns = null;

      function showPage(page) { publicPage.classList.toggle('active', page === 'public'); dashboardPage.classList.toggle('active', page === 'dashboard'); adminPage.classList.toggle('active', page === 'admin');}
      function showModal(el) { el.classList.remove('hidden'); }
      function hideModal(el) { el.classList.add('hidden'); }
      function showPublicSection(sectionId) { publicSections.forEach(s => s.classList.toggle('active', s.id === sectionId)); publicNavItems.forEach(item => { item.classList.toggle('text-blue-600', item.dataset.section === sectionId); item.classList.toggle('text-gray-600', item.dataset.section !== sectionId); }); window.scrollTo({ top: 0, behavior: 'smooth' }); }
      function toggleSidebar() { sidebar.classList.toggle('-translate-x-full'); sidebarOverlay.classList.toggle('hidden'); }
      function toggleAdminSidebar() { adminSidebar.classList.toggle('-translate-x-full'); adminSidebarOverlay.classList.toggle('hidden'); }
      function updateViewTitle(newTitle) { viewTitle.textContent = newTitle; }
      function showDashboardView(viewId) { dashboardPage.querySelectorAll('.view').forEach(v => v.classList.toggle('active', v.id === `${viewId}-view`)); dashboardNavItems.forEach(item => { item.classList.toggle('bg-gray-200', item.dataset.view === viewId); if (item.dataset.view === viewId) { updateViewTitle(item.textContent.trim()); } }); if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) { toggleSidebar(); } }
      function showAdminView(viewId) { adminPage.querySelectorAll('.view').forEach(v => v.classList.toggle('active', v.id === `${viewId}-view`)); }
      function showMessage(title, text, duration = 0) { document.getElementById('message-title').textContent = title; document.getElementById('message-text').textContent = text; showModal(messageModal); if (duration > 0) setTimeout(() => hideModal(messageModal), duration); }
      function matchFacility(primaryDetails) { const type = primaryDetails.PrimaryTestType; if (type === 'Vibration') return mockFacilities[1]; if (type === 'Thermal') return mockFacilities[2]; if (type === 'Shock') return mockFacilities[1]; return mockFacilities[0]; }
      
      async function handleLogin(e) { e.preventDefault(); const email = loginForm.querySelector('#login-email').value; const password = loginForm.querySelector('#login-password').value; const isAdminLogin = loginForm.querySelector('#admin-login-checkbox').checked; if (isAdminLogin && email !== 'admin@testbedz.com') { showMessage('Login Error', 'Invalid administrator email.'); return; } try { await signInWithEmailAndPassword(auth, email, password); hideModal(loginModal); } catch(error) { showMessage('Login Error', error.message); } }
      function handleLogout() { signOut(auth); }
      async function handleInitialSignup(e) {
          e.preventDefault();
          const formData = new FormData(signupForm);
          const email = formData.get('email');
          const password = formData.get('password');
          try {
              const userCredential = await createUserWithEmailAndPassword(auth, email, password);
              const user = userCredential.user;
              const newCampaign = { userId: user.uid, userEmail: user.email, companyName: formData.get('CompanyName'), contactName: formData.get('ContactName'), testPurpose: formData.get('TestPurpose'), testBackground: `Initial campaign for ${formData.get('PrimaryTestType')} testing.`, createdAt: serverTimestamp(), status: 'Awaiting Facility Response', facilityId: matchFacility({ PrimaryTestType: formData.get('PrimaryTestType') }).id };
              const campaignRef = await addDoc(collection(db, "campaigns"), newCampaign);
              const firstTest = { type: formData.get('PrimaryTestType'), details: { 'Initial Frequency Range': formData.get('FreqRange'), 'Initial Temperature Range': formData.get('TempRange'), 'Initial Shock Range': formData.get('ShockRange'), } };
              await addDoc(collection(db, "campaigns", campaignRef.id, "tests"), firstTest);
          } catch (error) {
              showMessage('Signup Error', error.message);
          }
      }
      async function handleCreateNewCampaign(e) { e.preventDefault(); if (!auth.currentUser) return; const fd = new FormData(newCampaignForm); const newCampaign = { userId: auth.currentUser.uid, userEmail: auth.currentUser.email, testPurpose: fd.get('TestPurpose'), testBackground: fd.get('TestBackground'), createdAt: serverTimestamp(), status: 'New Request' }; await addDoc(collection(db, "campaigns"), newCampaign); hideModal(newCampaignModal); }
      async function handleAddTest(e) { e.preventDefault(); if (!currentCampaignId) return; const testType = addTestForm.querySelector('#new-test-type-select').value; if (!testType) { showMessage('Error', 'Please select a test type.'); return; } const details = {}; const inputs = addTestForm.querySelectorAll('.specific-fields input, .specific-fields select, .specific-fields textarea'); inputs.forEach(input => { const label = input.closest('div').querySelector('label'); if (label) { details[label.textContent.replace('i','').trim()] = input.value || 'N/A'; } }); details['Standard'] = addTestForm.querySelector('#test-standard-select').value; const testData = { type: testType, details: details }; await addDoc(collection(db, "campaigns", currentCampaignId, "tests"), testData); const campaignRef = doc(db, "campaigns", currentCampaignId); await updateDoc(campaignRef, { status: "Facility Matching" }); hideModal(addTestModal); showMessage('Test Added', `A new ${testType} test has been added.`); }

      function listenForUserCampaigns(userId) { if (unsubscribeCampaigns) unsubscribeCampaigns(); const q = query(collection(db, "campaigns"), where("userId", "==", userId), orderBy("createdAt", "desc")); unsubscribeCampaigns = onSnapshot(q, (querySnapshot) => { const campaigns = []; querySnapshot.forEach((doc) => { campaigns.push({ id: doc.id, ...doc.data() }); }); renderUserCampaigns(campaigns); }); }
      function listenForAllCampaigns() { if (unsubscribeCampaigns) unsubscribeCampaigns(); const q = query(collection(db, "campaigns"), orderBy("createdAt", "desc")); unsubscribeCampaigns = onSnapshot(q, (querySnapshot) => { const campaigns = []; querySnapshot.forEach((doc) => { campaigns.push({ id: doc.id, ...doc.data() }); }); renderAdminCampaigns(campaigns); }); }

      function renderUserCampaigns(campaigns) { const container = document.getElementById('campaign-tickets-container'); container.innerHTML = `<table class="w-full text-left"><thead><tr class="border-b"><th class="p-4 font-semibold">Campaign Purpose</th><th class="p-4 font-semibold">Status</th><th class="p-4 font-semibold">Created</th></tr></thead><tbody></tbody></table>`; const tbody = container.querySelector('tbody'); tbody.innerHTML = ''; if (campaigns.length === 0) { tbody.innerHTML = '<tr><td colspan="3" class="text-center text-gray-500 p-6">You haven\'t created any test campaigns yet.</td></tr>'; return; } campaigns.forEach(campaign => { const row = tbody.insertRow(); row.className = 'border-b hover:bg-gray-50 cursor-pointer'; row.dataset.id = campaign.id; const statusClass = campaign.status.toLowerCase().replace(/ /g, ''); row.innerHTML = `<td class="p-4 font-semibold text-blue-600">${campaign.testPurpose}</td><td class="p-4"><span class="status-badge status-${statusClass}">${campaign.status}</span></td><td class="p-4 text-gray-600">${campaign.createdAt?.toDate().toLocaleDateString() || 'N/A'}</td>`; row.addEventListener('click', () => showCampaignDetail(campaign.id)); }); }
      function renderAdminCampaigns(campaigns) { adminCampaignsContainer.innerHTML = `<table class="w-full text-left"><thead><tr class="border-b"><th class="p-4 font-semibold">Campaign Purpose</th><th class="p-4 font-semibold">User</th><th class="p-4 font-semibold">Status</th><th class="p-4 font-semibold">Created</th></tr></thead><tbody></tbody></table>`; const tbody = adminCampaignsContainer.querySelector('tbody'); tbody.innerHTML = ''; if (campaigns.length === 0) { tbody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500 p-6">No campaigns submitted yet.</td></tr>'; return; } campaigns.forEach(campaign => { const row = tbody.insertRow(); row.className = 'border-b hover:bg-gray-50 cursor-pointer'; row.dataset.id = campaign.id; const statusClass = campaign.status.toLowerCase().replace(/ /g, ''); row.innerHTML = `<td class="p-4 font-semibold text-purple-600">${campaign.testPurpose}</td><td class="p-4 text-gray-600">${campaign.userEmail}</td><td class="p-4"><span class="status-badge status-${statusClass}">${campaign.status}</span></td><td class="p-4 text-gray-600">${campaign.createdAt?.toDate().toLocaleDateString() || 'N/A'}</td>`; row.addEventListener('click', () => showAdminCampaignDetail(campaign.id)); }); }
      function showCampaignDetail(campaignId) { currentCampaignId = campaignId; const campaignDocRef = doc(db, "campaigns", campaignId); onSnapshot(campaignDocRef, (docSnap) => { if (!docSnap.exists()) return; const campaign = {id: docSnap.id, ...docSnap.data()}; document.getElementById('detail-campaign-purpose').textContent = campaign.testPurpose; document.getElementById('detail-campaign-background').textContent = campaign.testBackground || ''; const statusBadge = document.getElementById('detail-campaign-status'); statusBadge.textContent = campaign.status; statusBadge.className = `status-badge status-${campaign.status.toLowerCase().replace(/ /g, '')}`; renderTestsForCampaign(campaign.id); showDashboardView('campaign-detail'); }); }
      async function showAdminCampaignDetail(campaignId) { const campaignDocRef = doc(db, "campaigns", campaignId); onSnapshot(campaignDocRef, (docSnap) => { if (!docSnap.exists()) return; const campaign = {id: docSnap.id, ...docSnap.data()}; document.getElementById('admin-detail-campaign-purpose').textContent = campaign.testPurpose; document.getElementById('admin-detail-campaign-background').textContent = campaign.testBackground || ''; document.getElementById('admin-detail-user-email').textContent = campaign.userEmail; const statusBadge = document.getElementById('admin-detail-campaign-status'); statusBadge.textContent = campaign.status; statusBadge.className = `status-badge status-${campaign.status.toLowerCase().replace(/ /g, '')}`; renderTestsForAdmin(campaign.id); renderAdminStatusControls(campaign.id, campaign.status); showAdminView('admin-campaign-detail'); }); }
      async function renderTestsForCampaign(campaignId) { const container = document.getElementById('tests-container'); const testsSnapshot = await getDocs(collection(db, "campaigns", campaignId, "tests")); container.innerHTML = ''; if (testsSnapshot.empty) { container.innerHTML = '<p class="text-gray-500">No specific tests have been added.</p>'; return; } testsSnapshot.forEach(doc => { const test = doc.data(); const testEl = document.createElement('div'); testEl.className = 'p-4 border rounded-lg bg-gray-50'; let detailsHtml = Object.entries(test.details).map(([key, value]) => { if (!value || value === 'on') return ''; const formattedKey = key.replace(/([A-Z])/g, ' $1').trim(); return `<p class="text-sm text-gray-600"><strong class="text-gray-800">${formattedKey}:</strong> ${value}</p>`; }).join(''); testEl.innerHTML = `<h4 class="font-semibold text-lg">${test.type}</h4><div class="mt-2 space-y-1">${detailsHtml}</div>`; container.appendChild(testEl); }); }
      async function renderTestsForAdmin(campaignId) { const container = document.getElementById('admin-tests-container'); const testsSnapshot = await getDocs(collection(db, "campaigns", campaignId, "tests")); container.innerHTML = ''; if (testsSnapshot.empty) { container.innerHTML = '<p class="text-gray-500">No specific tests have been added.</p>'; return; } testsSnapshot.forEach(doc => { const test = doc.data(); const testEl = document.createElement('div'); testEl.className = 'p-4 border rounded-lg bg-gray-50'; let detailsHtml = Object.entries(test.details).map(([key, value]) => { if (!value || value === 'on') return ''; const formattedKey = key.replace(/([A-Z])/g, ' $1').trim(); return `<p class="text-sm text-gray-600"><strong class="text-gray-800">${formattedKey}:</strong> ${value}</p>`; }).join(''); testEl.innerHTML = `<h4 class="font-semibold text-lg">${test.type}</h4><div class="mt-2 space-y-1">${detailsHtml}</div>`; container.appendChild(testEl); }); }
      function renderAdminStatusControls(campaignId, currentStatus) { const container = document.getElementById('admin-status-controls'); container.innerHTML = ''; const statuses = ['Awaiting Facility Response', 'Facility Matching', 'Contract Pending', 'Planning', 'Testing', 'Complete']; statuses.forEach(status => { const btn = document.createElement('button'); btn.textContent = status; btn.className = 'btn-primary px-3 py-1 rounded-md text-sm disabled:bg-gray-400'; if (status === currentStatus) { btn.disabled = true; } btn.addEventListener('click', () => updateCampaignStatus(campaignId, status)); container.appendChild(btn); }); }
      async function updateCampaignStatus(campaignId, newStatus) { const campaignRef = doc(db, "campaigns", campaignId); await updateDoc(campaignRef, { status: newStatus }); showMessage('Status Updated', `Campaign status changed to ${newStatus}.`); }
      
      onAuthStateChanged(auth, (user) => {
        if (user) {
          if (unsubscribeCampaigns) unsubscribeCampaigns();
          if (user.email === 'admin@testbedz.com') {
            listenForAllCampaigns();
            showPage('admin');
          } else {
            listenForUserCampaigns(user.uid);
            showPage('dashboard');
          }
        } else {
          if (unsubscribeCampaigns) unsubscribeCampaigns();
          showPage('public');
        }
      });
      
      function renderFacilityCards() { if (!facilitiesGrid) return; facilitiesGrid.innerHTML = ''; sprFacilities.forEach(facility => { const card = document.createElement('div'); card.className = 'bg-white rounded-lg shadow-lg overflow-hidden flex flex-col'; card.innerHTML = `<img src="${facility.image}" alt="${facility.name}" class="w-full h-48 object-cover"><div class="p-6 flex-grow flex flex-col"><h3 class="font-poppins font-bold text-xl mb-2 text-gray-900">${facility.name}</h3><p class="text-gray-600 mb-4 flex-grow">${facility.shortDesc}</p><button data-facility-id="${facility.id}" class="facility-info-btn mt-auto font-semibold text-blue-600 hover:text-blue-700 self-start">More Info →</button></div>`; facilitiesGrid.appendChild(card); }); }
      function openFacilityModal(facilityId) { const facility = sprFacilities.find(f => f.id === facilityId); if (!facility) return; document.getElementById('modal-facility-img').src = facility.image; document.getElementById('modal-facility-name').textContent = facility.name; document.getElementById('modal-facility-desc').textContent = facility.longDesc; const specsList = document.getElementById('modal-facility-specs'); specsList.innerHTML = ''; for (const [key, value] of Object.entries(facility.specs)) { const li = document.createElement('li'); li.innerHTML = `<strong class="font-semibold text-gray-800">${key}:</strong> ${value}`; specsList.appendChild(li); } showModal(facilityInfoModal); }
      function setupAddTestForm() {
        addTestForm.reset();
        const addTestFormStepsContainer = document.getElementById('add-test-form-steps');
        const standardsStep = document.getElementById('standards-step').cloneNode(true);
        addTestFormStepsContainer.innerHTML = '';
        addTestFormStepsContainer.appendChild(standardsStep);
        addTestFormStepsContainer.querySelector('#new-test-type-select').addEventListener('change', (e) => {
            const testType = e.target.value.replace(/\s|\//g, '');
            const templateId = `${testType}-fields`;
            const template = document.getElementById(templateId);
            const oldFields = addTestFormStepsContainer.querySelector('.specific-fields');
            if(oldFields) oldFields.remove();
            if (template) {
                const newFields = document.createElement('div');
                newFields.className = 'specific-fields space-y-4 pt-6 mt-6 border-t';
                newFields.innerHTML = template.innerHTML;
                const safetySection = document.createElement('div');
                safetySection.className = 'pt-4 mt-4 border-t space-y-4';
                safetySection.innerHTML = `<div><label class="block text-sm font-medium text-red-700">Safety & Materials<span class="tooltip">i<span class="tooltiptext">List all materials used. Note any potential for outgassing (e.g., foams, adhesives). This is critical for vacuum tests.</span></span></label><textarea class="mt-1 w-full border-gray-300 rounded-md" rows="2" placeholder="e.g., Aluminum 6061, Kapton tape, Stycast 2850FT..." required></textarea></div><div><label class="block text-sm font-medium text-gray-700">Are there any relevant requirements you think we should know about?</label><textarea class="mt-1 w-full border-gray-300 rounded-md" rows="2"></textarea></div><div><label class="flex items-center text-sm font-medium text-red-700">Safety: Is there stored energy?<span class="tooltip">i<span class="tooltiptext">e.g., batteries, pressurized vessels, springs, etc.</span></span></label><div class="mt-2 flex space-x-4"><label class="inline-flex items-center"><input type="radio" name="stored-energy" class="rounded"> <span class="ml-2">Yes</span></label><label class="inline-flex items-center"><input type="radio" name="stored-energy" class="rounded" checked> <span class="ml-2">No</span></label></div></div>`;
                newFields.appendChild(safetySection);
                addTestFormStepsContainer.appendChild(newFields);
                const thermocoupleSelect = newFields.querySelector('#thermocouple-select');
                if (thermocoupleSelect) {
                    thermocoupleSelect.addEventListener('change', function() {
                        const reasonBox = newFields.querySelector('#thermocouple-reason-box');
                        reasonBox.classList.toggle('hidden', this.value !== '10+');
                    });
                }
            }
        });
        showModal(addTestModal);
      }
      
      document.getElementById('next-btn').addEventListener('click', () => { const currentFormStep = signupFormSteps[currentSignupStep - 1]; const inputs = currentFormStep.querySelectorAll('input[required], textarea[required], select[required]'); let isValid = true; for (const input of inputs) { if (!input.value.trim()) { isValid = false; input.focus(); break; } } if (isValid && currentSignupStep < signupFormSteps.length) { signupFormSteps[currentSignupStep - 1].classList.remove('active'); currentSignupStep++; signupFormSteps[currentSignupStep - 1].classList.add('active'); document.getElementById('prev-btn').style.display = 'block'; if (currentSignupStep === signupFormSteps.length) { document.getElementById('next-btn').style.display = 'none'; document.getElementById('submit-btn').style.display = 'block'; } } else if (!isValid) { showMessage('Incomplete Information', 'Please fill out all required fields in this step.'); } });
      document.getElementById('prev-btn').addEventListener('click', () => { if (currentSignupStep > 1) { signupFormSteps[currentSignupStep - 1].classList.remove('active'); currentSignupStep--; signupFormSteps[currentSignupStep - 1].classList.add('active'); document.getElementById('submit-btn').style.display = 'none'; document.getElementById('next-btn').style.display = 'block'; if (currentSignupStep === 1) document.getElementById('prev-btn').style.display = 'none'; } });
      document.getElementById('initial-test-type').addEventListener('change', (e) => { document.querySelectorAll('.conditional-field').forEach(f => f.classList.remove('active')); const selectedType = e.target.value; const fieldToShow = document.getElementById(`${selectedType}-params`); if (fieldToShow) fieldToShow.classList.add('active'); });
      publicNavItems.forEach(item => item.addEventListener('click', (e) => { e.preventDefault(); showPublicSection(e.currentTarget.dataset.section); }));
      getStartedLinks.forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); showPublicSection('home-content'); setTimeout(() => document.getElementById('rfq-form').scrollIntoView({ behavior: 'smooth' }), 100); }));
      dashboardNavItems.forEach(item => item.addEventListener('click', (e) => { e.preventDefault(); showDashboardView(e.currentTarget.dataset.view); }));
      if (faqContainer) { faqContainer.addEventListener('click', (e) => { const questionHeader = e.target.closest('.faq-question'); if (!questionHeader) return; const answer = questionHeader.nextElementSibling; const icon = questionHeader.querySelector('.faq-icon'); const isOpening = !answer.classList.contains('open'); faqContainer.querySelectorAll('.faq-answer.open').forEach(openAnswer => { if (openAnswer !== answer) { openAnswer.classList.remove('open'); openAnswer.previousElementSibling.querySelector('.faq-icon').style.transform = 'rotate(0deg)'; } }); answer.classList.toggle('open'); icon.style.transform = isOpening ? 'rotate(45deg)' : 'rotate(0deg)'; }); }
      showLoginBtn.addEventListener('click', () => showModal(loginModal));
      closeLoginModalBtn.addEventListener('click', () => hideModal(loginModal));
      logoutBtn.addEventListener('click', handleLogout);
      adminLogoutBtn.addEventListener('click', handleLogout);
      hamburgerBtn.addEventListener('click', toggleSidebar);
      sidebarOverlay.addEventListener('click', toggleSidebar);
      sidebarCloseBtn.addEventListener('click', toggleSidebar);
      adminHamburgerBtn.addEventListener('click', toggleAdminSidebar);
      adminSidebarOverlay.addEventListener('click', toggleAdminSidebar);
      adminSidebarCloseBtn.addEventListener('click', toggleAdminSidebar);
      showNewCampaignModalBtn.addEventListener('click', () => showModal(newCampaignModal));
      closeNewCampaignModalBtn.addEventListener('click', () => hideModal(newCampaignModal));
      showAddTestModalBtn.addEventListener('click', setupAddTestForm);
      closeAddTestModalBtn.addEventListener('click', () => hideModal(addTestModal));
      backToDashboardBtn.addEventListener('click', () => showDashboardView('dashboard'));
      adminBackToDashboardBtn.addEventListener('click', () => showAdminView('admin-dashboard'));
      closeMessageBtn.addEventListener('click', () => hideModal(messageModal));
      proceedToDashboardBtn.addEventListener('click', () => hideModal(facilityIntroModal));
      if (facilitiesGrid) { facilitiesGrid.addEventListener('click', function(e) { const button = e.target.closest('.facility-info-btn'); if (button) { const facilityId = button.dataset.facilityId; openFacilityModal(facilityId); } }); }
      if(closeFacilityInfoModalBtn) { closeFacilityInfoModalBtn.addEventListener('click', () => hideModal(facilityInfoModal)); }
      loginForm.addEventListener('submit', handleLogin);
      signupForm.addEventListener('submit', handleInitialSignup);
      newCampaignForm.addEventListener('submit', handleCreateNewCampaign);
      addTestForm.addEventListener('submit', handleAddTest);

      /* ---------- INITIALIZATION ---------- */
      renderFacilityCards();
    });
  </script>
</body>
</html>
